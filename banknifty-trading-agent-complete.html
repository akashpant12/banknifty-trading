<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BankNifty Trading Agent - Complete Code</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #1a1a2e; color: #eee; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        h1 { color: #00d9ff; margin-bottom: 10px; }
        h2 { color: #00ff88; margin: 30px 0 15px; border-bottom: 2px solid #00ff88; padding-bottom: 10px; }
        h3 { color: #ff6b6b; margin: 20px 0 10px; }
        .file-header { background: #16213e; padding: 10px 15px; border-radius: 8px 8px 0 0; border: 1px solid #0f3460; border-bottom: none; }
        .file-name { font-weight: bold; color: #ffd93d; font-family: monospace; }
        pre { background: #0f0f23; padding: 15px; border-radius: 0 0 8px 8px; border: 1px solid #0f3460; overflow-x: auto; font-size: 13px; line-height: 1.5; }
        code { font-family: 'Fira Code', 'Consolas', monospace; }
        .section { margin: 40px 0; }
        .nav { position: fixed; top: 20px; right: 20px; background: #16213e; padding: 15px; border-radius: 10px; border: 1px solid #0f3460; max-height: 80vh; overflow-y: auto; }
        .nav a { display: block; color: #00d9ff; text-decoration: none; padding: 5px 0; font-size: 13px; }
        .nav a:hover { color: #00ff88; }
        .copy-btn { background: #00ff88; color: #1a1a2e; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .copy-btn:hover { background: #00cc6a; }
        .note { background: #2d1f3d; border-left: 4px solid #9b59b6; padding: 15px; margin: 20px 0; border-radius: 0 8px 8px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üáÆüá≥ BankNifty Trading Agent - Complete Code</h1>
        <p>Copy the code below and paste it into your GitHub repository. All files are ready to use.</p>
        
        <div class="note">
            <strong>Quick Start:</strong> Create a new repository on GitHub, then clone it locally and create these files. Run <code>bun install && bun dev</code> to start.
        </div>

        <nav class="nav">
            <strong style="color: #ffd93d;">Files</strong>
            <a href="#package-json">package.json</a>
            <a href="#next-config">next.config.ts</a>
            <a href="#tsconfig">tsconfig.json</a>
            <a href="#eslint">eslint.config.mjs</a>
            <a href="#postcss">postcss.config.mjs</a>
            <a href="#gitignore">.gitignore</a>
            <a href="#layout">src/app/layout.tsx</a>
            <a href="#globals">src/app/globals.css</a>
            <a href="#home">src/app/page.tsx</a>
            <a href="#trading">src/app/trading/page.tsx</a>
            <a href="#api-route">src/app/api/angel-one/login/route.ts</a>
            <a href="#types">src/lib/trading/types.ts</a>
            <a href="#config">src/lib/trading/config.ts</a>
            <a href="#data">src/lib/trading/banknifty-data.ts</a>
            <a href="#strategy">src/lib/trading/strategy-engine.ts</a>
            <a href="#order">src/lib/trading/order-manager.ts</a>
            <a href="#api">src/lib/trading/angel-one-api.ts</a>
        </nav>

        <!-- package.json -->
        <div class="section" id="package-json">
            <div class="file-header"><span class="file-name">package.json</span></div>
            <pre><code>{
  "name": "banknifty-trading-agent",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint",
    "typecheck": "tsc --noEmit"
  },
  "dependencies": {
    "next": "^16.1.3",
    "react": "^19.2.3",
    "react-dom": "^19.2.3"
  },
  "devDependencies": {
    "typescript": "^5.9.3",
    "@types/node": "^24.10.2",
    "@types/react": "^19.2.7",
    "@types/react-dom": "^19.2.3",
    "@tailwindcss/postcss": "^4.1.17",
    "tailwindcss": "^4.1.17",
    "eslint": "^9.39.1",
    "eslint-config-next": "^16.0.0"
  }
}</code></pre>
        </div>

        <!-- next.config.ts -->
        <div class="section" id="next-config">
            <div class="file-header"><span class="file-name">next.config.ts</span></div>
            <pre><code>import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;</code></pre>
        </div>

        <!-- tsconfig.json -->
        <div class="section" id="tsconfig">
            <div class="file-header"><span class="file-name">tsconfig.json</span></div>
            <pre><code>{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [{ "name": "next" }],
    "paths": { "@/*": ["./src/*"] }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}</code></pre>
        </div>

        <!-- eslint.config.mjs -->
        <div class="section" id="eslint">
            <div class="file-header"><span class="file-name">eslint.config.mjs</span></div>
            <pre><code>import nextConfig from "eslint-config-next";

const eslintConfig = [
  ...nextConfig,
  { ignores: ["node_modules/**"] },
];

export default eslintConfig;</code></pre>
        </div>

        <!-- postcss.config.mjs -->
        <div class="section" id="postcss">
            <div class="file-header"><span class="file-name">postcss.config.mjs</span></div>
            <pre><code>const config = {
  plugins: ["@tailwindcss/postcss"],
};

export default config;</code></pre>
        </div>

        <!-- .gitignore -->
        <div class="section" id="gitignore">
            <div class="file-header"><span class="file-name">.gitignore</span></div>
            <pre><code>node_modules
.next
.env
.env.local
.env.*.local
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.DS_Store</code></pre>
        </div>

        <!-- src/app/layout.tsx -->
        <div class="section" id="layout">
            <div class="file-header"><span class="file-name">src/app/layout.tsx</span></div>
            <pre><code>import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({ variable: "--font-geist-sans", subsets: ["latin"] });
const geistMono = Geist_Mono({ variable: "--font-geist-mono", subsets: ["latin"] });

export const metadata: Metadata = {
  title: "BankNifty Trading Agent",
  description: "Automated trading with multi-strategy analysis",
};

export default function RootLayout({ children }: Readonly<{ children: React.ReactNode; }>) {
  return (
    <html lang="en">
      <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
        {children}
      </body>
    </html>
  );
}</code></pre>
        </div>

        <!-- src/app/globals.css -->
        <div class="section" id="globals">
            <div class="file-header"><span class="file-name">src/app/globals.css</span></div>
            <pre><code>@import "tailwindcss";</code></pre>
        </div>

        <!-- src/app/page.tsx -->
        <div class="section" id="home">
            <div class="file-header"><span class="file-name">src/app/page.tsx</span></div>
            <pre><code>import Link from 'next/link';

export default function Home() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white">
      <main className="max-w-6xl mx-auto px-6 py-20">
        <div className="text-center mb-16">
          <h1 className="text-5xl font-bold mb-4 bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent">
            BankNifty Trading Agent
          </h1>
          <p className="text-xl text-gray-400 mb-8">
            Automated trading with multi-strategy analysis for BankNifty futures & options
          </p>
          <Link href="/trading" className="inline-block px-8 py-4 bg-emerald-600 hover:bg-emerald-500 rounded-lg font-bold text-lg transition-all">
            Open Trading Dashboard ‚Üí
          </Link>
        </div>

        <div className="grid md:grid-cols-3 gap-8 mb-16">
          {[
            { title: "üìä Real-Time Analysis", desc: "Multi-indicator technical analysis with RSI, MACD, Moving Averages, and Bollinger Bands" },
            { title: "‚ö° Auto-Trading", desc: "Enable automated trading based on strategy signals with configurable confidence thresholds" },
            { title: "üìà Option Chain", desc: "View live option chain data with Open Interest analysis for strikes near ATM" },
            { title: "üí∞ Portfolio Tracking", desc: "Track positions, P&L, margin requirements, and overall portfolio performance" },
            { title: "üéØ Multiple Strategies", desc: "Trend following, mean reversion, momentum, and scalping strategies available" },
            { title: "üîß Broker Integration", desc: "Ready for integration with Indian brokers like Zerodha, Upstox, and Angel One" }
          ].map((f, i) => (
            <div key={i} className="bg-gray-800 rounded-xl p-6 hover:bg-gray-750 transition-all">
              <h3 className="text-xl font-bold mb-2">{f.title}</h3>
              <p className="text-gray-400">{f.desc}</p>
            </div>
          ))}
        </div>

        <div className="bg-yellow-900/30 border border-yellow-700 rounded-lg p-6">
          <h3 className="font-bold text-yellow-400 mb-2">‚ö†Ô∏è Risk Disclaimer</h3>
          <p className="text-gray-300 text-sm">
            Trading in BankNifty futures and options involves substantial risk of loss. 
            This trading agent is for educational and demonstration purposes only.
          </p>
        </div>
      </main>
    </div>
  );
}</code></pre>
        </div>

        <!-- src/app/trading/page.tsx -->
        <div class="section" id="trading">
            <div class="file-header"><span class="file-name">src/app/trading/page.tsx</span></div>
            <pre><code>'use client';
import { useState, useEffect, useCallback } from 'react';

// Types
interface BankNiftyQuote { symbol: string; lastPrice: number; previousClose: number; open: number; high: number; low: number; volume: number; bid: number; ask: number; timestamp: Date; change: number; changePercent: number; }
interface Trade { id: string; symbol: string; type: 'BUY' | 'SELL'; quantity: number; price: number; timestamp: Date; status: string; strategy?: string; profitLoss?: number; }
interface Position { symbol: string; quantity: number; averagePrice: number; currentPrice: number; type: string; unrealizedPL: number; realizedPL: number; }
interface TradingSignal { strategy: string; action: string; confidence: number; target?: number; stopLoss?: number; timestamp: Date; }
interface PortfolioSummary { totalValue: number; cashBalance: number; unrealizedPL: number; realizedPL: number; dayPL: number; marginAvailable: number; }

// Data Service
function getBankNiftyQuote(): BankNiftyQuote {
  const BANK_NIFTY_BASE_PRICE = 52000;
  const price = BANK_NIFTY_BASE_PRICE + (Math.random() - 0.5) * 2 * 0.015 * BANK_NIFTY_BASE_PRICE;
  const change = price - BANK_NIFTY_BASE_PRICE;
  return {
    symbol: 'BANKNIFTY', lastPrice: Number(price.toFixed(2)), previousClose: BANK_NIFTY_BASE_PRICE,
    open: BANK_NIFTY_BASE_PRICE + (Math.random() - 0.5) * 0.02 * BANK_NIFTY_BASE_PRICE,
    high: price * 1.01, low: price * 0.99,
    volume: Math.floor(Math.random() * 50000000) + 10000000, bid: price - 0.5, ask: price + 0.5,
    timestamp: new Date(), change: Number(change.toFixed(2)), changePercent: Number((change / BANK_NIFTY_BASE_PRICE * 100).toFixed(2))
  };
}

function getOptionChain() {
  const quote = getBankNiftyQuote();
  const basePrice = Math.round(quote.lastPrice / 100) * 100;
  return Array.from({ length: 21 }, (_, i) => {
    const strikePrice = basePrice + (i - 10) * 100;
    const callBase = Math.max(0.5, (basePrice + 100 - strikePrice) * 0.1);
    const putBase = Math.max(0.5, (strikePrice - basePrice + 100) * 0.1);
    return {
      strikePrice, call: { bid: Math.random() * callBase, ask: Math.random() * callBase * 1.05, openInterest: Math.floor(Math.random() * 5000000) + 500000 },
      put: { bid: Math.random() * putBase, ask: Math.random() * putBase * 1.05, openInterest: Math.floor(Math.random() * 5000000) + 500000 }
    };
  });
}

// Strategy Engine
class StrategyEngine {
  private priceHistory: number[] = [];
  private signals: TradingSignal[] = [];
  addPrice(price: number) { this.priceHistory.push(price); if (this.priceHistory.length > 200) this.priceHistory.shift(); }
  getSignals() { return this.signals.slice(-50); }
  
  analyzeMAcrossover(quote: BankNiftyQuote) {
    this.addPrice(quote.lastPrice);
    if (this.priceHistory.length < 20) return null;
    const shortMA = this.priceHistory.slice(-5).reduce((a, b) => a + b, 0) / 5;
    const longMA = this.priceHistory.slice(-20).reduce((a, b) => a + b, 0) / 20;
    const prevShortMA = this.priceHistory.slice(-6, -1).reduce((a, b) => a + b, 0) / 5;
    const prevLongMA = this.priceHistory.slice(-21, -1).reduce((a, b) => a + b, 0) / 20;
    
    if (prevShortMA <= prevLongMA && shortMA > longMA) return this.createSignal('MA Crossover', 'BUY', 0.75);
    if (prevShortMA >= prevLongMA && shortMA < longMA) return this.createSignal('MA Crossover', 'SELL', 0.75);
    return null;
  }

  analyzeRSI(quote: BankNiftyQuote) {
    this.addPrice(quote.lastPrice);
    if (this.priceHistory.length < 15) return 50;
    const changes = this.priceHistory.slice(1).map((p, i) => p - this.priceHistory[i]);
    const gains = changes.map(c => Math.max(0, c));
    const losses = changes.map(c => Math.max(0, -c));
    const avgGain = gains.slice(-14).reduce((a, b) => a + b, 0) / 14;
    const avgLoss = losses.slice(-14).reduce((a, b) => a + b, 0) / 14;
    if (avgLoss === 0) return 100;
    return 100 - (100 / (1 + avgGain / avgLoss));
  }

  analyzeCombined(quote: BankNiftyQuote): TradingSignal | null {
    const signals: TradingSignal[] = [];
    const maSignal = this.analyzeMAcrossover(quote);
    if (maSignal) signals.push(maSignal);
    const rsi = this.analyzeRSI(quote);
    if (rsi <= 30) signals.push(this.createSignal('RSI Oversold', 'BUY', (30 - rsi) / 30));
    if (rsi >= 70) signals.push(this.createSignal('RSI Overbought', 'SELL', (rsi - 70) / 30));
    
    const buySignals = signals.filter(s => s.action === 'BUY');
    const sellSignals = signals.filter(s => s.action === 'SELL');
    if (buySignals.length >= 2) return this.createSignal('Combined', 'BUY', buySignals.reduce((s, x) => s + x.confidence, 0) / buySignals.length);
    if (sellSignals.length >= 2) return this.createSignal('Combined', 'SELL', sellSignals.reduce((s, x) => s + x.confidence, 0) / sellSignals.length);
    return null;
  }

  private createSignal(strategy: string, action: string, confidence: number): TradingSignal {
    const signal: TradingSignal = { strategy, action, confidence: Math.min(confidence, 1), timestamp: new Date() };
    this.signals.push(signal);
    return signal;
  }
}

// Order Manager
class OrderManager {
  private trades: Trade[] = [];
  private positions: Map<string, Position> = new Map();
  private cashBalance = 100000;
  
  placeOrder(symbol: string, type: 'BUY' | 'SELL', quantity: number, price: number, strategy?: string): Trade {
    const order: Trade = { id: `ORD-${Date.now()}`, symbol, type, timestamp: new Date(), status: 'PENDING',, quantity, price strategy };
    this.cashBalance -= type === 'BUY' ? price * quantity : -price * quantity;
    if (type === 'BUY') {
      const existing = this.positions.get(symbol);
      if (existing) {
        existing.quantity += quantity;
        existing.averagePrice = (existing.averagePrice * (existing.quantity - quantity) + price * quantity) / existing.quantity;
      } else {
        this.positions.set(symbol, { symbol, quantity, averagePrice: price, currentPrice: price, type: 'LONG', unrealizedPL: 0, realizedPL: 0 });
      }
    } else {
      const pos = this.positions.get(symbol);
      if (pos) { pos.realizedPL += (price - pos.averagePrice) * quantity; pos.quantity -= quantity; if (pos.quantity === 0) this.positions.delete(symbol); }
    }
    order.status = 'EXECUTED';
    this.trades.push(order);
    return order;
  }
  
  getPositions() { return Array.from(this.positions.values()); }
  getTrades() { return this.trades; }
  getPortfolioSummary(currentPrice: number) {
    this.positions.forEach((pos) => { pos.currentPrice = currentPrice; pos.unrealizedPL = (currentPrice - pos.averagePrice) * pos.quantity; });
    const totalValue = this.cashBalance + Array.from(this.positions.values()).reduce((s, p) => s + p.quantity * p.currentPrice, 0);
    return { totalValue, cashBalance: this.cashBalance, unrealizedPL: 0, realizedPL: 0, dayPL: 0, marginAvailable: this.cashBalance * 5 };
  }
}

const strategyEngine = new StrategyEngine();
const orderManager = new OrderManager();

export default function TradingDashboard() {
  const [quote, setQuote] = useState<BankNiftyQuote | null>(null);
  const [optionChain, setOptionChain] = useState<any[]>([]);
  const [positions, setPositions] = useState<Position[]>([]);
  const [trades, setTrades] = useState<Trade[]>([]);
  const [signals, setSignals] = useState<TradingSignal[]>([]);
  const [portfolio, setPortfolio] = useState<PortfolioSummary | null>(null);
  const [orderType, setOrderType] = useState<'BUY' | 'SELL'>('BUY');
  const [orderQuantity, setOrderQuantity] = useState(25);
  const [isAutoTrading, setIsAutoTrading] = useState(false);
  const [priceHistory, setPriceHistory] = useState<number[]>([]);

  useEffect(() => {
    const updateData = () => {
      const newQuote = getBankNiftyQuote();
      setQuote(newQuote);
      setOptionChain(getOptionChain());
      setPriceHistory(prev => [...prev.slice(-49), newQuote.lastPrice]);
      setPositions(orderManager.getPositions());
      setTrades(orderManager.getTrades());
      setSignals(strategyEngine.getSignals());
      setPortfolio(orderManager.getPortfolioSummary(newQuote.lastPrice));
    };
    updateData();
    const interval = setInterval(updateData, 2000);
    return () => clearInterval(interval);
  }, []);

  useEffect(() => {
    if (isAutoTrading && quote) {
      const signal = strategyEngine.analyzeCombined(quote);
      if (signal && signal.action !== 'HOLD' && signal.confidence > 0.6) {
        orderManager.placeOrder('BANKNIFTY', signal.action as 'BUY' | 'SELL', orderQuantity, quote.lastPrice, signal.strategy);
      }
    }
  }, [isAutoTrading, quote, orderQuantity]);

  const handlePlaceOrder = () => {
    if (!quote) return;
    orderManager.placeOrder('BANKNIFTY', orderType, orderQuantity, quote.lastPrice, 'Manual');
  };

  return (
    <div className="min-h-screen bg-gray-900 text-white p-6">
      <header className="mb-8">
        <h1 className="text-3xl font-bold text-emerald-400">üáÆüá≥ BankNifty Trading Agent</h1>
        <p className="text-gray-400 mt-2">Automated trading with multi-strategy analysis</p>
      </header>

      {quote && portfolio && (
        <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8">
          {[
            { label: 'BankNifty', value: quote.lastPrice.toFixed(2), change: quote.changePercent },
            { label: 'Portfolio', value: `‚Çπ${portfolio.totalValue.toLocaleString()}`, sub: `P/L: ‚Çπ${portfolio.dayPL.toFixed(0)}` },
            { label: 'Cash', value: `‚Çπ${portfolio.cashBalance.toLocaleString()}`, sub: `Margin: ‚Çπ${portfolio.marginAvailable.toLocaleString()}` },
            { label: 'Positions', value: positions.length.toString(), sub: `Unrealized: ‚Çπ${portfolio.unrealizedPL.toFixed(0)}` },
            { label: 'Trades', value: trades.length.toString() },
            { label: 'Signals', value: signals.filter(s => s.action !== 'HOLD').length.toString(), sub:isAutoTrading ? 'ON' : `Auto: ${ 'OFF'}` }
          ].map((stat, i) => (
            <div key={i} className="bg-gray-800 rounded-lg p-4">
              <div className="text-gray-400 text-sm">{stat.label}</div>
              <div className="text-xl font-bold mt-1">{stat.value}</div>
              {stat.change !== undefined && <div className={`text-sm ${stat.change >= 0 ? 'text-green-400' : 'text-red-400'}`}>{stat.change >= 0 ? '+' : ''}{stat.change.toFixed(2)}%</div>}
              {stat.sub && <div className="text-xs text-gray-500 mt-1">{stat.sub}</div>}
            </div>
          ))}
        </div>
      )}

      <div className="grid md:grid-cols-2 gap-6 mb-6">
        <div className="bg-gray-800 rounded-xl p-6">
          <h3 className="text-lg font-semibold mb-4">Price Movement</h3>
          <div className="h-64 bg-gray-900 rounded-lg flex items-end justify-between p-4 gap-1">
            {priceHistory.map((price, i) => {
              const min = Math.min(...priceHistory);
              const max = Math.max(...priceHistory);
              const height = ((price - min) / (max - min || 1)) * 100;
              return <div key={i} className="flex-1 bg-emerald-500 rounded-t" style={{ height: `${Math.max(height, 5)}%` }} />;
            })}
          </div>
        </div>

        <div className="bg-gray-800 rounded-xl p-6">
          <h3 className="text-lg font-semibold mb-4">Quick Trade</h3>
          <div className="grid grid-cols-2 gap-4 mb-4">
            <button onClick={() => setOrderType('BUY')} className={`py-3 rounded-lg font-bold ${orderType === 'BUY' ? 'bg-green-600' : 'bg-gray-700'}`}>BUY</button>
            <button onClick={() => setOrderType('SELL')} className={`py-3 rounded-lg font-bold ${orderType === 'SELL' ? 'bg-red-600' : 'bg-gray-700'}`}>SELL</button>
          </div>
          <div className="mb-4">
            <label className="block text-sm text-gray-400 mb-2">Quantity (lots)</label>
            <input type="number" value={orderQuantity} onChange={(e) => setOrderQuantity(Number(e.target.value))} className="w-full bg-gray-700 rounded-lg px-4 py-3" min="1" max="100" />
          </div>
          <button onClick={handlePlaceOrder} className="w-full py-4 bg-emerald-600 hover:bg-emerald-500 rounded-lg font-bold">Place {orderType} Order</button>
        </div>
      </div>

      <div className="grid md:grid-cols-2 gap-6">
        <div className="bg-gray-800 rounded-xl p-6">
          <h3 className="text-lg font-semibold mb-4">Trading Signals</h3>
          <div className="flex justify-between items-center mb-4 p-3 bg-gray-700 rounded">
            <span className="font-bold">Auto-Trading Mode</span>
            <button onClick={() => setIsAutoTrading(!isAutoTrading)} className={`px-4 py-1 rounded ${isAutoTrading ? 'bg-green-600' : 'bg-gray-600'}`}>{isAutoTrading ? 'ON' : 'OFF'}</button>
          </div>
          <div className="space-y-2 max-h-64 overflow-y-auto">
            {signals.slice(-10).reverse().map((s, i) => (
              <div key={i} className={`p-2 rounded ${s.action === 'BUY' ? 'bg-green-900/30' : s.action === 'SELL' ? 'bg-red-900/30' : 'bg-gray-700'}`}>
                <span className={`font-bold ${s.action === 'BUY' ? 'text-green-400' : s.action === 'SELL' ? 'text-red-400' : 'text-gray-400'}`}>{s.action}</span>
                <span className="ml-2 text-gray-400">{s.strategy}</span>
                <span className="float-right text-sm text-gray-400">{(s.confidence * 100).toFixed(0)}%</span>
              </div>
            ))}
          </div>
        </div>

        <div className="bg-gray-800 rounded-xl p-6">
          <h3 className="text-lg font-semibold mb-4">Open Positions</h3>
          <div className="space-y-2">
            {positions.map((pos, i) => (
              <div key={i} className="bg-gray-700 rounded-lg p-3">
                <div className="flex justify-between">
                  <span className="font-bold">{pos.symbol}</span>
                  <span className={pos.unrealizedPL >= 0 ? 'text-green-400' : 'text-red-400'}>{pos.unrealizedPL >= 0 ? '+' : ''}‚Çπ{pos.unrealizedPL.toFixed(0)}</span>
                </div>
                <div className="text-sm text-gray-400">{pos.quantity} lots @ ‚Çπ{pos.averagePrice.toFixed(2)}</div>
              </div>
            ))}
            {positions.length === 0 && <p className="text-gray-500 text-center py-4">No open positions</p>}
          </div>
        </div>
      </div>

      <div className="bg-gray-800 rounded-xl p-6 mt-6">
        <h3 className="text-lg font-semibold mb-4">Option Chain</h3>
        <div className="overflow-x-auto">
          <table className="w-full text-sm">
            <thead>
              <tr className="bg-gray-700">
                <th className="p-2 text-left">Strike</th>
                <th className="p-2 text-right text-green-400">Call Bid</th>
                <th className="p-2 text-right text-red-400">Put Bid</th>
                <th className="p-2 text-right text-gray-400">OI</th>
              </tr>
            </thead>
            <tbody>
              {optionChain.slice(0, 15).map((opt, i) => (
                <tr key={i} className="border-b border-gray-700">
                  <td className="p-2 font-bold">‚Çπ{opt.strikePrice}</td>
                  <td className="p-2 text-right text-green-400">‚Çπ{opt.call.bid.toFixed(1)}</td>
                  <td className="p-2 text-right text-red-400">‚Çπ{opt.put.bid.toFixed(1)}</td>
                  <td className="p-2 text-right text-gray-400">{(opt.call.openInterest / 100000).toFixed(1)}L</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}</code></pre>
        </div>

        <!-- src/lib/trading/types.ts -->
        <div class="section" id="types">
            <div class="file-header"><span class="file-name">src/lib/trading/types.ts</span></div>
            <pre><code>export interface BankNiftyQuote {
  symbol: string; lastPrice: number; previousClose: number; open: number; high: number; low: number;
  volume: number; bid: number; ask: number; timestamp: Date; change: number; changePercent: number;
}

export interface OptionChain {
  strikePrice: number;
  call: { bid: number; ask: number; volume: number; openInterest: number; };
  put: { bid: number; ask: number; volume: number; openInterest: number; };
}

export interface Trade {
  id: string; symbol: string; type: 'BUY' | 'SELL'; quantity: number; price: number;
  timestamp: Date; status: 'PENDING' | 'EXECUTED' | 'CANCELLED' | 'FAILED'; strategy?: string; profitLoss?: number;
}

export interface Position {
  symbol: string; quantity: number; averagePrice: number; currentPrice: number;
  type: 'LONG' | 'SHORT'; unrealizedPL: number; realizedPL: number;
}

export interface TradingSignal {
  strategy: string; action: 'BUY' | 'SELL' | 'HOLD'; confidence: number; target?: number; stopLoss?: number; timestamp: Date;
}

export interface PortfolioSummary {
  totalValue: number; cashBalance: number; unrealizedPL: number; realizedPL: number; dayPL: number; marginAvailable: number;
}</code></pre>
        </div>

        <!-- src/lib/trading/config.ts -->
        <div class="section" id="config">
            <div class="file-header"><span class="file-name">src/lib/trading/config.ts</span></div>
            <pre const angelOneConfig><code>export = {
  apiKey: 'YOUR_API_KEY_HERE',
  username: 'YOUR_USERNAME',
  password: 'YOUR_PASSWORD',
  totp: '123456',
  usePaperTrading: true,
};</code></pre>
        </div>

        <!-- src/lib/trading/banknifty-data.ts -->
        <div class="section" id="data">
            <div class="file-header"><span class="file-name">src/lib/trading/banknifty-data.ts</span></div>
            <pre><code>import { BankNiftyQuote, OptionChain } from './types';

const BANK_NIFTY_BASE_PRICE = 52000;

function generateRandomPrice(base: number, volatility: number = 0.02): number {
  return Number((base + (Math.random() - 0.5) * 2 * volatility * base).toFixed(2));
}

export function getBankNiftyQuote(): BankNiftyQuote {
  const price = generateRandomPrice(BANK_NIFTY_BASE_PRICE, 0.015);
  const change = price - BANK_NIFTY_BASE_PRICE;
  return { symbol: 'BANKNIFTY', lastPrice: price, previousClose: BANK_NIFTY_BASE_PRICE,
    open: generateRandomPrice(BANK_NIFTY_BASE_PRICE, 0.01), high: price * 1.01, low: price * 0.99,
    volume: Math.floor(Math.random() * 50000000) + 10000000, bid: price - 0.5, ask: price + 0.5,
    timestamp: new Date(), change: Number(change.toFixed(2)), changePercent: Number((change / BANK_NIFTY_BASE_PRICE * 100).toFixed(2)) };
}

export function getOptionChain(atmStrike?: number): OptionChain[] {
  const quote = getBankNiftyQuote();
  const basePrice = atmStrike || Math.round(quote.lastPrice / 100) * 100;
  return Array.from({ length: 21 }, (_, i) => {
    const strikePrice = basePrice + (i - 10) * 100;
    const callBase = Math.max(0.5, (basePrice + 100 - strikePrice) * 0.1);
    const putBase = Math.max(0.5, (strikePrice - basePrice + 100) * 0.1);
    return { strikePrice,
      call: { bid: generateRandomPrice(callBase, 0.1), ask: generateRandomPrice(callBase * 1.05, 0.1), volume: Math.floor(Math.random() * 1000000) + 100000, openInterest: Math.floor(Math.random() * 5000000) + 500000 },
      put: { bid: generateRandomPrice(putBase, 0.1), ask: generateRandomPrice(putBase * 1.05, 0.1), volume: Math.floor(Math.random() * 1000000) + 100000, openInterest: Math.floor(Math.random() * 5000000) + 500000 }
    };
  });
}

export function calculateMovingAverage(prices: number[], period: number): number {
  if (prices.length < period) return prices.reduce((a, b) => a + b, 0) / prices.length;
  return prices.slice(-period).reduce((a, b) => a + b, 0) / period;
}

export function calculateRSI(prices: number[], period: number = 14): number {
  if (prices.length < period + 1) return 50;
  const changes = prices.slice(1).map((p, i) => p - prices[i]);
  const gains = changes.map(c => Math.max(0, c));
  const losses = changes.map(c => Math.max(0, -c));
  const avgGain = gains.slice(-period).reduce((a, b) => a + b, 0) / period;
  const avgLoss = losses.slice(-period).reduce((a, b) => a + b, 0) / period;
  if (avgLoss === 0) return 100;
  return 100 - (100 / (1 + avgGain / avgLoss));
}</code></pre>
        </div>

        <!-- src/lib/trading/strategy-engine.ts -->
        <div class="section" id="strategy">
            <div class="file-header"><span class="file-name">src/lib/trading/strategy-engine.ts</span></div>
            <pre><code>import { BankNiftyQuote, TradingSignal } from './types';
import { calculateMovingAverage, calculateRSI } from './banknifty-data';

export class StrategyEngine {
  private priceHistory: number[] = [];
  private signals: TradingSignal[] = [];

  addPrice(price: number) { this.priceHistory.push(price); if (this.priceHistory.length > 200) this.priceHistory.shift(); }
  getSignals() { return this.signals.slice(-50); }

  analyzeMAcrossover(quote: BankNiftyQuote, shortPeriod = 5, longPeriod = 20) {
    this.addPrice(quote.lastPrice);
    if (this.priceHistory.length < longPeriod) return null;
    const shortMA = calculateMovingAverage(this.priceHistory, shortPeriod);
    const longMA = calculateMovingAverage(this.priceHistory, longPeriod);
    const prevShortMA = calculateMovingAverage(this.priceHistory.slice(0, -1), shortPeriod);
    const prevLongMA = calculateMovingAverage(this.priceHistory.slice(0, -1), longPeriod);
    if (prevShortMA <= prevLongMA && shortMA > longMA) return this.createSignal('MA Crossover', 'BUY', 0.75);
    if (prevShortMA >= prevLongMA && shortMA < longMA) return this.createSignal('MA Crossover', 'SELL', 0.75);
    return null;
  }

  analyzeRSI(quote: BankNiftyQuote, period = 14, oversold = 30, overbought = 70) {
    this.addPrice(quote.lastPrice);
    if (this.priceHistory.length < period + 1) return null;
    const rsi = calculateRSI(this.priceHistory, period);
    if (rsi <= oversold) return this.createSignal('RSI Oversold', 'BUY', (30 - rsi) / 30);
    if (rsi >= overbought) return this.createSignal('RSI Overbought', 'SELL', (rsi - 70) / 30);
    return null;
  }

  analyzeCombined(quote: BankNiftyQuote): TradingSignal | null {
    const signals: TradingSignal[] = [];
    const maSignal = this.analyzeMAcrossover(quote);
    const rsiSignal = this.analyzeRSI(quote);
    if (maSignal) signals.push(maSignal);
    if (rsiSignal) signals.push(rsiSignal);
    const buySignals = signals.filter(s => s.action === 'BUY');
    const sellSignals = signals.filter(s => s.action === 'SELL');
    if (buySignals.length >= 2) return this.createSignal('Combined', 'BUY', buySignals.reduce((s, x) => s + x.confidence, 0) / buySignals.length);
    if (sellSignals.length >= 2) return this.createSignal('Combined', 'SELL', sellSignals.reduce((s, x) => s + x.confidence, 0) / sellSignals.length);
    return null;
  }

  private createSignal(strategy: string, action: 'BUY' | 'SELL' | 'HOLD', confidence: number): TradingSignal {
    const signal: TradingSignal = { strategy, action, confidence: Math.min(confidence, 1), timestamp: new Date() };
    this.signals.push(signal);
    return signal;
  }
}

export const strategyEngine = new StrategyEngine();</code></pre>
        </div>

        <!-- src/lib/trading/order-manager.ts -->
        <div class="section" id="order">
            <div class="file-header"><span class="file-name">src/lib/trading/order-manager.ts</span></div>
            <pre><code>import { Trade, Position, PortfolioSummary } from './types';

export class OrderManager {
  private trades: Trade[] = [];
  private positions: Map<string, Position> = new Map();
  private cashBalance = 100000;

  placeOrder(symbol: string, type: 'BUY' | 'SELL', quantity: number, price: number, strategy?: string): Trade {
    const order: Trade = { id: `ORD-${Date.now()}`, symbol, type, quantity, price, timestamp: new Date(), status: 'PENDING', strategy };
    if (type === 'BUY') {
      this.cashBalance -= price * quantity;
      const existing = this.positions.get(symbol);
      if (existing) {
        existing.quantity += quantity;
        existing.averagePrice = (existing.averagePrice * (existing.quantity - quantity) + price * quantity) / existing.quantity;
      } else {
        this.positions.set(symbol, { symbol, quantity, averagePrice: price, currentPrice: price, type: 'LONG', unrealizedPL: 0, realizedPL: 0 });
      }
    } else {
      const pos = this.positions.get(symbol);
      if (pos) { pos.realizedPL += (price - pos.averagePrice) * quantity; pos.quantity -= quantity; if (pos.quantity === 0) this.positions.delete(symbol); }
    }
    order.status = 'EXECUTED';
    this.trades.push(order);
    return order;
  }

  getPositions() { return Array.from(this.positions.values()); }
  getTrades() { return this.trades; }
  getPortfolioSummary() {
    const positions = this.getPositions();
    const totalValue = this.cashBalance + positions.reduce((s, p) => s + p.quantity * p.currentPrice, 0);
    return { totalValue, cashBalance: this.cashBalance, unrealizedPL: 0, realizedPL: 0, dayPL: 0, marginAvailable: this.cashBalance * 5 };
  }
}

export const orderManager = new OrderManager();</code></pre>
        </div>

        <!-- src/lib/trading/angel-one-api.ts -->
        <div class="section" id="api">
            <div class="file-header"><span class="file-name">src/lib/trading/angel-one-api.ts</span></div>
            <pre><code>import { BankNiftyQuote, Trade, Position, PortfolioSummary } from './types';

export interface AngelOneConfig { apiKey: string; username: string; password: string; totp: string; }

export class AngelOneAPI {
  private config: AngelOneConfig | null = null;
  private session: any = null;
  private baseUrl = 'https://apidev.angelbroking.com';
  private orderBaseUrl = 'https://api.angelbroking.com';

  configure(config: AngelOneConfig) { this.config = config; }

  async generateSession() {
    if (!this.config) throw new Error('API credentials not configured');
    const response = await fetch(`${this.baseUrl}/gtt/v1/login`, {
      method: 'POST', headers: { 'Content-Type': 'application/json', 'X-ApiKey': this.config.apiKey },
      body: JSON.stringify({ clientcode: this.config.username, password: this.config.password, totp: this.config.totp }),
    });
    const data = await response.json();
    if (data.status === 'OK' && data.data) { this.session = data.data; return this.session; }
    throw new Error(data.message || 'Login failed');
  }

  private getHeaders() { return { 'Content-Type': 'application/json', 'Authorization': `Bearer ${this.session?.jwtToken}`, 'X-ApiKey': this.config!.apiKey, 'X-ClientCode': this.config!.username }; }

  async getQuote(symbol = 'BANKNIFTY'): Promise<BankNiftyQuote | null> {
    try {
      const response = await fetch(`${this.orderBaseUrl}/v1/quote`, { method: 'POST', headers: this.getHeaders(), body: JSON.stringify({ exchange: 'NSE', tradingsymbol: symbol, symboltoken: '9999' }) });
      const data = await response.json();
      if (data.status) { return { symbol: data.data.tradingsymbol, lastPrice: parseFloat(data.data.ltp), previousClose: parseFloat(data.data.prefclose), open: parseFloat(data.data.open), high: parseFloat(data.data.high), low: parseFloat(data.data.low), volume: parseInt(data.data.volume), bid: parseFloat(data.data.bidprice), ask: parseFloat(data.data.askprice), timestamp: new Date(), change: parseFloat(data.data.change), changePercent: (parseFloat(data.data.change) / parseFloat(data.data.prefclose)) * 100 }; }
      return null;
    } catch { return null; }
  }

  async placeOrder(symbol: string, type: 'BUY' | 'SELL', quantity: number, productType = 'INTRADAY', orderType = 'MARKET', price?: number): Promise<Trade | null> {
    try {
      const response = await fetch(`${this.orderBaseUrl}/v1/order/place`, { method: 'POST', headers: this.getHeaders(), body: JSON.stringify({ exchange: 'NSE', tradingsymbol: symbol, quantity: quantity * 25, producttype: productType, ordertype: type, price: price || 0, variety: 'NORMAL', duration: 'DAY' }) });
      const data = await response.json();
      if (data.status) return { id: data.data.orderid, symbol, type, quantity, price: price || 0, timestamp: new Date(), status: 'PENDING' };
      return null;
    } catch { return null; }
  }

  async logout() { this.session = null; }
}

export const angelOneAPI = new AngelOneAPI();</code></pre>
        </div>

        <!-- API Route -->
        <div class="section" id="api-route">
            <div class="file-header"><span class="file-name">src/app/api/angel-one/login/route.ts</span></div>
            <pre><code>import { NextResponse } from 'next/server';

export async function POST(request: Request) {
  try {
    const { apiKey, username, password, totp } = await request.json();
    const response = await fetch('https://apidev.angelbroking.com/gtt/v1/login', {
      method: 'POST', headers: { 'Content-Type': 'application/json', 'X-ApiKey': apiKey },
      body: JSON.stringify({ clientcode: username, password, totp }),
    });
    const data = await response.json();
    return NextResponse.json(data);
  } catch (error: any) {
    return NextResponse.json({ status: false, message: error.message || 'API request failed' }, { status: 500 });
  }
}</code></pre>
        </div>

        <div class="note" style="margin-top: 40px;">
            <strong>To deploy to Vercel:</strong>
            <ol style="margin-top: 10px; margin-left: 20px;">
                <li>Push all files to GitHub</li>
                <li>Go to vercel.com and import the repository</li>
                <li>Vercel will automatically detect Next.js and deploy</li>
                <li>Your app will be live at https://your-repo.vercel.app</li>
            </ol>
        </div>
    </div>
</body>
</html>